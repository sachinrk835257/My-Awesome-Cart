<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.2.1/css/all.css">
    <title>{% block title %} {% endblock %}</title>
    <!-- <link rel="stylesheet" href="style.css"> -->

    <style>
        .carousel-control-prev {
            left: -55px;
            top: 50%;
            background-color: red;
            border-radius: 50%;
            width: 2%;
            bottom: auto;
        }

        .carousel-control-next {
            right: -55px;
            top: 50%;
            background-color: red;
            border-radius: 50%;
            width: 2%;
            bottom: auto;

        }

        .addPlsMins {
            column-gap: 10px;
            display: inline-flex;
            align-items: baseline;
            /* justify-content: center; */
            font-size: 1.1rem;
        }

        footer {
            background-color: #504848;
            color: white;
            padding-top: 5px;
        }

        .slides {
            background-color: black;
        }

        .popover {

            max-width: 184px;
            line-height: 1.3rem;
            text-align: center;
            height: 59px;
        }

        .popover-body {
            padding: 0.5rem;
        }
    </style>
    {% block css %}
    {% endblock %}
</head>

<body>

    <!-- MY NAVBAR   -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/shop">My Awesome Cart</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="/shop" href="/shop">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/shop/about">About</a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/shop/tracker">Tracker</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/blog">Blog</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/shop/contact">Contact Us</a>
                    </li>

                    <!-- <li class="nav-item">
                        <a class="nav-link" href="#">Cart <span id="numbers">0</span></a>
                    </li> -->
                </ul>
                <form class="d-flex" action="/shop/yourCart/" method="post">{% csrf_token %}
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <a href="/shop/search"><button class="btn btn-outline-success" type="submit">Search</button></a>
                    <input type="hidden" name="prodId" readonly id="readonlyId"
                        style="opacity: 0; position: absolute;z-index: -1;">
                    <a href="/shop/yourCart" id="form2Submit"><button type="submit" id="popcart"
                            class="btn btn-secondary mx-2" data-html="true" data-container="body" data-toggle="popover"
                            title="your items are here" data-bs-trigger="hover focus" data-placement="right"
                            style="width: 9rem;">
                            Cart (<span id="cartNumbers"></span>)</button></a>




                </form>
                <!-- <form action="/shop/yourCart/" method="post" style="opacity: 0; position: absolute;z-index: -1;">{% csrf_token %}
                    <input type="text" name="prodId" readonly id="readonlyId">
                    <button type="submit" id="opct0sbmt">submit</button>
                </form> -->
            </div>
        </div>
    </nav>
    {% block body %} {% endblock %}

    <!-- here is my footer -->
    <footer class="my-5">
        <div class="container-fluid my-footer">
            <div class="row">
                <div class="col-4 offset-1 col-sm-2">
                    <h5> <span class="fa fa-link"></span> Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="/shop/Home" style="font-size:1.0rem;">Home</a></li>
                        <li><a href="/shop/About">About Us</a></li>
                        <li><a href="">Coperative Federelism</a></li>
                        <li><a href="">Contact Us</a></li>
                    </ul>
                </div>
                <div class="col-7 col-sm-5">
                    <h5> <span class="fa fa-map-marker"></span> Address</h5>
                    <address class="address">
                        Akbarpur, Ambedkar Nagar,UP, 224151
                        <br>
                        <i class="fa fa-phone"> </i> &nbsp;: +9161585396<br>
                        <i class="fa fa-fax"> </i> : +1880011120<br>
                        <i class="fa fa-envelope"> </i> : <a class="rsp-mail"
                            href="mailto:sachinrk835257@gmail.com">sachinrk835257@gmail.com</a>
                    </address>
                </div>
                <div class="col-12 col-sm-4 align-self-center">
                    <div class="text-center">
                        <h5 class="text-center">Social Media</h5>
                        <hr style="border-top: 1px dashed #327FBF">
                        <a class="btn btn-social-icon btn-facebook" href="#"><i
                                class="fa-brands fa-square-facebook"></i></a>
                        <a class="btn btn-social-icon btn-linkedin" href="#"><i class="fa-brands fa-linkedin"></i></a>
                        <a class="btn btn-social-icon btn-twitter" href="#"><i
                                class="fa-brands fa-square-twitter"></i></a>
                        <a class="btn btn-social-icon bg-light" href="mailto:aayushsiddharth14@gmail.com"><i
                                class="fa fa-envelope fa-lg"></i></a>
                    </div>
                </div>
            </div>
            <div class="row justify-content-center">
                <div class="col-auto">
                    <section class="sec Copyright">
                        <p class="footer_p_i_h2_a footer_p_i_a">Copyright &copy; SACHIN SEN & SANDEEP KUMAR| All Rights
                            Reserved | <a href="https://www.linkedin.com/in/aayush-kumar-siddharth-7a7339270"
                                style="color: teal;cursor: pointer;">Website Developed By SACHIN SEN & SANDEEP KUMAR</a>
                    </section>
                </div>
            </div>

        </div>

    </footer>



    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script> -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS. -->
    <!-- <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script> -->

    <!-- compressed jquery which is useful for ajax -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
-->
    <script defer>

        let form2Submit = document.getElementById('popcart')
        $('#checkOut').click(saveToCart())
        $('#popcart').click(saveToCart())
        function saveToCart() {
            var cart = JSON.parse(localStorage.getItem('cart'));
            var str1 = ""
            for (const key in cart) {
                if (cart[key] != 0) {
                    str1 += (key + " " + cart[key].toString() + " ")
                }

            }
            console.log(str1)
            document.getElementById('readonlyId').setAttribute('value', str1)
        }

        // show popover
        document.getElementById('popcart').addEventListener('mouseover', () => {
            $('#popcart').popover('show');
            document.getElementById("popcart").setAttribute('data-bs-original-title', 'Your items in my shopping cart');
        })

        //find the localstorage value of cart
        if (localStorage.getItem('cart') == null) {
            var cart = {}
        }
        else {
            var cart = JSON.parse(localStorage.getItem('cart'));
            countProds(cart);
        }

        //FUNCTION RUN WHEN WINDOW/PAGE IS LOADED
        window.addEventListener('load', function () {
            if (document.baseURI.indexOf('shop/prodView') != -1) {
                var prodId = "prod" + (document.baseURI).slice(-2,)
                var cart = JSON.parse(localStorage.getItem('cart'));
                updateCartBtn(cart, prodId);
            }

            if (document.baseURI == 'http://127.0.0.1:8000/shop/') {
                var cart = JSON.parse(localStorage.getItem('cart'));
                for (const key in cart) {

                    if (cart[key] != 0) {
                        updateCartBtn(cart, key);
                    }
                }
            }


            if (document.baseURI.indexOf('shop/checkOut') != -1) {
                console.log("in and out")
                // var cart = JSON.parse(localStorage.getItem('cart'));
                // for (const key in cart) {
                //     updateCartBtn(cart, key);
                // }
            }
            // window.addEventListener('click', run)
        })


        // $('.cart').click(function () {
        // this event is not triggered when we change the html dynamically so below code is used for     
        //instead of this for trigger the event dynamically
        $('.divbtns').on('click', 'button.cart', function () {
            console.log("in jquery .on")
            var prodId = this.id.toString();
            // console.log(cart)
            if (cart[prodId] != undefined) {
                cart[prodId] = cart[prodId] + 1


            }
            else {
                cart[prodId] = 1
            }
            localStorage.setItem('cart', JSON.stringify(cart))
            countProds(cart);
            updateCartBtn(cart, prodId);
            console.log("out jquery .on")
        })



        function countProds(cart) {
            // console.log('in countProds')
            let count = 0
            let items = Object.keys(cart)
            for (const j in items) {
                if (Object.hasOwnProperty.call(items, j)) {
                    const element = items[j];
                    count += (cart[element])

                }
            }
            document.getElementById('cartNumbers').innerHTML = count;
            // console.log('out countProds')
        }

        function updateCartBtn(cart, prodId) {
            // console.log("in updateCartBtn")
            countProds(cart);
            let id1 = prodId.slice(4,)

            // console.log("prod" + id1)
            let spn = document.getElementById("prod" + id1).parentElement
            // console.log("<button id='minus" + id1 + "' " + "type='button' class='btn btn-warning cart'>-</button>" + "<span id='itemsOf" + prodId + "'>" + cart["prod" + id1].toString() + "</span>" + "<button id='plus" + id1 + "' " + "type='button' class='btn btn-warning cart'>+</button>\n")

            // console.log("<button id='prod" + id1.toString() + "'" + " type='button' class='btn btn-warning cart'>Add To Cart</button>")
            // spn.className = "plusMinus"
            spn.innerHTML = "<button id='minus" + id1 + "' " + "type='button' class='btn btn-warning minus'>-</button>" + "<span id='itemsOf" + prodId + "'>" + cart["prod" + id1].toString() + "</span>" + "<button id='plus" + id1 + "' " + "type='button' class='btn btn-warning plus'>+</button>"
            let countText = document.getElementById("itemsOf" + prodId)
            if (countText.innerText == '0') {
                // console.log("<button id='prod" + id1.toString() + "'" + " type='button' class='btn btn-warning cart'>Add To Cart</button>")
                spn.innerHTML = "<button id='prod" + id1.toString() + "'" + " type='button' class='btn btn-warning cart'>Add To Cart</button>"
                // spn.className = "divbtns"
            }

            // console.log("out updateCartBtn")
        }

        $('.divbtns').on('click', 'button.plus', function (e) {
            let targetId = (e.target.id).toString()
            if (targetId.indexOf('plus') != -1) {
                // console.log("click on plus btn")
                cart["prod" + targetId.slice(4,)] = cart["prod" + targetId.slice(4,)] + 1       //strat slicing with 4 "plus"

                localStorage.setItem('cart', JSON.stringify(cart))      //must update the local storage
                let prodId = ("prod" + targetId.slice(4,))
                document.getElementById('itemsOf' + prodId).innerHTML = cart["prod" + targetId.slice(4,)];
                countProds(cart);
            }
        })

        $('.divbtns').on('click', 'button.minus', function (e) {
            let targetId = (e.target.id).toString()
            if (targetId.indexOf('minus') != -1) {
                // console.log("click on minus btn")
                cart["prod" + targetId.slice(5,)] = cart["prod" + targetId.slice(5,)] - 1       //strat slicing with 5 "minus"
                cart["prod" + targetId.slice(5,)] = Math.max(0, (cart["prod" + targetId.slice(5,)]))
                localStorage.setItem('cart', JSON.stringify(cart))      //must update the local storage
                let prodId = ("prod" + targetId.slice(5,))
                document.getElementById('itemsOf' + prodId).innerHTML = cart["prod" + targetId.slice(5,)];
                countProds(cart);
                let countText = document.getElementById("itemsOf" + prodId)
                console.log(countText)
                if (countText.innerText == '0') {

                    document.getElementById('rplc' + targetId.slice(5,)).innerHTML = "<button id='prod" + targetId.slice(5,) + "'" + " type='button' class='btn btn-warning cart'>Add To Cart</button>"
                    document.getElementById('rplc' + targetId.slice(5,)).className = "divbtns"
                }
            }
        })

      
    </script>
    {% block js %}
    {% endblock %}
</body>

</html>